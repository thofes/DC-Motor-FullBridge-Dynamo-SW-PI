Version 4
SHEET 1 3848 2500
WIRE -3920 -1920 -3920 -1936
WIRE -3488 -1920 -3488 -1936
WIRE -3712 -1856 -3792 -1856
WIRE -3616 -1856 -3712 -1856
WIRE -3152 -1856 -3360 -1856
WIRE -3920 -1776 -3920 -1792
WIRE -3152 -1760 -3152 -1856
WIRE -3040 -1760 -3152 -1760
WIRE -2864 -1744 -2976 -1744
WIRE -3040 -1728 -3152 -1728
WIRE -3488 -1696 -3488 -1712
WIRE -3008 -1696 -3008 -1712
WIRE -3616 -1648 -3664 -1648
WIRE -3152 -1632 -3152 -1728
WIRE -3152 -1632 -3360 -1632
WIRE -3616 -1616 -3664 -1616
WIRE -3456 -1456 -3696 -1456
WIRE -2960 -1456 -3184 -1456
WIRE -3456 -1424 -3456 -1456
WIRE -2960 -1424 -2960 -1456
WIRE -3696 -1360 -3696 -1456
WIRE -3184 -1360 -3184 -1456
WIRE -4016 -1344 -4016 -1392
WIRE -3840 -1328 -3840 -1344
WIRE -3840 -1328 -3904 -1328
WIRE -3456 -1328 -3456 -1344
WIRE -3344 -1328 -3456 -1328
WIRE -2960 -1328 -2960 -1344
WIRE -2848 -1328 -2960 -1328
WIRE -3904 -1312 -3904 -1328
WIRE -3840 -1296 -3840 -1328
WIRE -3456 -1296 -3456 -1328
WIRE -2960 -1296 -2960 -1328
WIRE -4016 -1216 -4016 -1264
WIRE -3696 -1184 -3696 -1280
WIRE -3456 -1184 -3456 -1216
WIRE -3184 -1184 -3184 -1280
WIRE -2960 -1184 -2960 -1216
WIRE -3328 -928 -3824 -928
WIRE -3040 -912 -3104 -912
WIRE -3328 -896 -3696 -896
WIRE -3328 -864 -3504 -864
WIRE -3040 -864 -3104 -864
WIRE -3328 -832 -3392 -832
WIRE -3824 -800 -3824 -928
WIRE -3696 -800 -3696 -896
WIRE -3504 -800 -3504 -864
WIRE -3392 -800 -3392 -832
WIRE -3824 -688 -3824 -720
WIRE -3696 -688 -3696 -720
WIRE -3504 -688 -3504 -720
WIRE -3392 -688 -3392 -720
WIRE -3936 -384 -3968 -384
WIRE -3824 -384 -3856 -384
WIRE -3968 -320 -3968 -384
WIRE -3968 -320 -4048 -320
WIRE -3824 -320 -3824 -384
WIRE -3744 -320 -3824 -320
WIRE -3408 -320 -3568 -320
WIRE -3744 -288 -4048 -288
WIRE -3408 -288 -3568 -288
WIRE -3408 -256 -3568 -256
WIRE -3744 -240 -3968 -240
WIRE -3424 -224 -3568 -224
WIRE -3408 -224 -3424 -224
WIRE -2928 -224 -3008 -224
WIRE -3424 -208 -3424 -224
WIRE -3136 -208 -3424 -208
WIRE -2928 -192 -3008 -192
WIRE -4048 -96 -4048 -288
WIRE -3968 -96 -3968 -240
WIRE -4048 32 -4048 -16
WIRE -3968 32 -3968 -16
WIRE -3984 160 -4064 160
WIRE -3824 160 -3904 160
WIRE -3776 160 -3824 160
WIRE -3520 160 -3584 160
WIRE -3104 160 -3168 160
WIRE -4064 208 -4064 160
WIRE -3824 224 -3824 160
WIRE -3584 224 -3584 160
WIRE -3168 224 -3168 160
WIRE -4064 352 -4064 288
WIRE -3824 352 -3824 288
WIRE -3584 352 -3584 304
WIRE -3168 352 -3168 304
FLAG -4064 352 0
FLAG -3824 352 0
FLAG -3776 160 El_Power
FLAG -3520 160 Shaft_Power
FLAG -3584 352 0
FLAG -3104 160 Eff
FLAG -3168 352 0
FLAG -4048 32 0
FLAG -3968 32 0
FLAG -3408 -288 RPM
FLAG -3408 -256 Torque
FLAG -3408 -224 Wmech
FLAG -4048 -320 A
FLAG -3408 -320 B
FLAG -3456 -1184 0
FLAG -2928 -224 ref
FLAG -3696 -1184 0
FLAG -2928 -192 M-
FLAG -3904 -1312 0
FLAG -3840 -1216 Vee
FLAG -3840 -1424 Vcc
FLAG -4016 -1216 0
FLAG -4016 -1392 Vcc30
FLAG -2864 -1744 pwm
FLAG -3008 -1696 0
FLAG -3008 -1776 Vcc30
FLAG -3488 -1936 Vcc
FLAG -3920 -1936 Vcc
FLAG -3920 -1776 Vee
FLAG -3664 -1648 signal
FLAG -3664 -1616 DAC
FLAG -3488 -1712 Vcc
FLAG -3712 -1856 square
FLAG -3152 -1856 triang
FLAG -3152 -1632 pi-ctrl
FLAG -3344 -1328 signal
FLAG -3184 -1184 0
FLAG -2960 -1184 0
FLAG -2848 -1328 DAC
FLAG -3968 -240 pwl
FLAG -3824 -688 0
FLAG -3504 -688 0
FLAG -3696 -688 0
FLAG -3392 -688 0
FLAG -3040 -912 A
FLAG -3040 -864 B
SYMBOL bv -4064 192 R0
SYMATTR InstName B1
SYMATTR Value V=v(A,B)*i(V9)
SYMBOL res -3888 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 5k
SYMBOL cap -3840 224 R0
SYMATTR InstName C1
SYMATTR Value 0.1µF
SYMBOL bv -3584 208 R0
SYMATTR InstName B2
SYMATTR Value V = V(Torque) * V(Wmech)
SYMBOL bv -3168 208 R0
SYMATTR InstName B3
SYMATTR Value V = V(Shaft_Power) / V(El_Power)
SYMBOL voltage -4048 -112 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 0
SYMBOL voltage -3968 -112 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PWL(0 0 0.0999 0 0.1 0.2612 0.1999 0.2612 0.2 0 0.2999 0 0.3 -0.2612 0.39999 -0.2612 0.4 0)
SYMBOL DC_Motor -3664 -272 R0
WINDOW 0 9 -104 Bottom 2
SYMATTR InstName X1
SYMBOL Dynamo -3072 -208 R0
SYMATTR InstName X2
SYMBOL res -3472 -1312 R0
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL res -3472 -1440 R0
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL bv -3696 -1376 R0
SYMATTR InstName B4
SYMATTR Value V=abs(V(ref))
SYMBOL voltage -3840 -1440 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 5
SYMBOL voltage -3840 -1312 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL voltage -4016 -1360 R0
SYMATTR InstName V10
SYMATTR Value 30
SYMBOL Comparators\\LT1716 -3008 -1744 R0
SYMATTR InstName U1
SYMBOL triangular-wave_generator -3472 -1856 R0
WINDOW 0 -126 -48 Bottom 2
SYMATTR InstName X3
SYMBOL square-wave_generator -3920 -1856 R0
WINDOW 0 -109 -47 Bottom 2
SYMATTR InstName X4
SYMBOL pi-ctrl -3440 -1616 R0
WINDOW 0 -158 -64 Bottom 2
SYMATTR InstName X5
SYMBOL voltage -3184 -1376 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 15
SYMBOL res -2976 -1312 R0
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res -2976 -1440 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL full_bridge -3280 -896 R0
SYMATTR InstName X6
SYMBOL voltage -3824 -816 R0
WINDOW 3 -13 175 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 28 16 Left 2
SYMATTR Value PULSE(1 0 0.2 0.001u 0 5)
SYMATTR InstName V3
SYMBOL voltage -3504 -816 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 24
SYMBOL bv -3696 -816 R0
SYMATTR InstName B5
SYMATTR Value V=v(pwm)
SYMBOL voltage -3392 -816 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 30
SYMBOL voltage -3952 -384 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
SYMATTR InstName V9
SYMATTR Value 0
TEXT -4120 -2088 Left 2 !.tran 0 0.4 0 1u uic
TEXT -3928 -1040 Left 2 ;Full bridge with direction selection
TEXT -4112 -2024 Left 2 ;PWM generation depending on the measured dynamo voltage
TEXT -3672 -1248 Left 2 ;dynamo voltage
TEXT -3160 -1256 Left 2 ;target voltage
TEXT -4128 -480 Left 2 ;DC-Motor with Load (PWL) and dynamo
RECTANGLE Normal -2736 -1088 -4128 -2048 2
RECTANGLE Normal -2928 -528 -3936 -1056 2
RECTANGLE Normal -2704 400 -4144 -496 2
